name: Автоочистка плейлиста

on:
  schedule:
    - cron: "0 2 * * *"  # Каждый день в 5:00 МСК (2:00 UTC)
  workflow_dispatch:      # Кнопка для ручного запуска

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Проверить плейлист
        uses: 4gray/iptv-checker@v1
        with:
          playlist: iptv.m3u8
          output: iptv.m3u8
          timeout: 10
          threads: 5
      
      - name: Сохранить изменения
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add iptv.m3u8
          git commit -m "Автоочистка: удалены нерабочие каналы" || echo "Нет изменений"
          git push
